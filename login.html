<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#007965" />
  <title>ุชุณุฌูู ุงูุฏุฎูู - CollectPro</title>
  <!-- ุชู ุชูุนูู ููู manifest.json ูุฏุนู ุฎุตุงุฆุต PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="public/logoapp.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="sidebar.css" />
  <link rel="stylesheet" href="login.css" />
  <meta name="csrf-token" content="YOUR_CSRF_TOKEN_HERE">
</head>
<body>
  <div class="login-container">
    <div class="login-card">
      <!-- ุดุนุงุฑ ุงูุชุทุจูู -->
      <div class="logo-container">
        <img src="public/logo-momkn.png" alt="ุดุนุงุฑ ูููู" class="logo" />
        <h1 class="app-name">CollectPro</h1>
        <p class="subtitle">ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุญุตููุงุช ุงููุชูุฏู</p>
      </div>
      
      <!-- ุฑุณุงุฆู ุงูุชูุจูู -->
      <div id="alert-container" class="alert-container"></div>
      
      <!-- ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู -->
      <form id="login-form" class="login-form">
        <div class="form-group">
          <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <div class="input-container">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" id="email" name="email" placeholder="ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู" required />
          </div>
          <span class="error-message" id="email-error"></span>
        </div>
        
        <div class="form-group">
          <label for="password">ูููุฉ ุงููุฑูุฑ</label>
          <div class="input-container">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" id="password" name="password" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" required />
            <button type="button" id="toggle-password" class="toggle-password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <span class="error-message" id="password-error"></span>
        </div>
        
        <div class="form-options">
          <div class="remember-me">
            <input type="checkbox" id="remember" name="remember" />
            <label for="remember">ุชุฐูุฑูู</label>
          </div>
          <a href="#" class="forgot-password">ูุณูุช ูููุฉ ุงููุฑูุฑุ</a>
        </div>
        
        <button type="submit" class="login-btn">
          <span class="btn-text">ุชุณุฌูู ุงูุฏุฎูู</span>
          <i class="fas fa-spinner fa-spin spinner"></i>
        </button>
        
        <div class="divider">
          <span>ุฃู</span>
        </div>
        
        <button type="button" id="google-login" class="google-login-btn">
          <i class="fab fa-google"></i>
          <span class="button-text">ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ Google</span>
          <div class="loading-spinner" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
        </button>
        
        <div class="signup-link">
          <p>ููุณ ูุฏูู ุญุณุงุจุ <a href="#">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</a></p>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ูููุฐุฌ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ -->
  <div id="forgot-password-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ</h2>
        <button class="close-modal">&times;</button>
      </div>
      <form id="forgot-password-form">
        <div class="form-group">
          <label for="reset-email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <div class="input-container">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" id="reset-email" placeholder="ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู" required />
          </div>
          <span class="error-message" id="reset-email-error"></span>
        </div>
        <button type="submit" class="submit-btn">ุฅุฑุณุงู ุฑุงุจุท ุงูุงุณุชุนุงุฏุฉ</button>
      </form>
    </div>
  </div>
  
  <!-- ูููุฐุฌ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ -->
  <div id="signup-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h2>
        <button class="close-modal">&times;</button>
      </div>
      <form id="signup-form">
        <div class="form-group">
          <label for="signup-name">ุงูุงุณู ุงููุงูู</label>
          <div class="input-container">
            <i class="fas fa-user input-icon"></i>
            <input type="text" id="signup-name" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู" required />
          </div>
          <span class="error-message" id="signup-name-error"></span>
        </div>
        
        <div class="form-group">
          <label for="signup-email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <div class="input-container">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" id="signup-email" placeholder="ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู" required />
          </div>
          <span class="error-message" id="signup-email-error"></span>
        </div>
        
        <div class="form-group">
          <label for="signup-password">ูููุฉ ุงููุฑูุฑ</label>
          <div class="input-container">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" id="signup-password" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" required />
            <button type="button" class="toggle-password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <span class="error-message" id="signup-password-error"></span>
          <div class="password-strength">
            <div class="strength-meter">
              <div class="strength-meter-fill"></div>
            </div>
            <span class="strength-text">ููุฉ ูููุฉ ุงููุฑูุฑ</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="signup-confirm-password">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ</label>
          <div class="input-container">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" id="signup-confirm-password" placeholder="ุฃุนุฏ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ" required />
            <button type="button" class="toggle-password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <span class="error-message" id="signup-confirm-password-error"></span>
        </div>
        
        <div class="form-group">
          <label for="signup-phone">ุฑูู ุงููุงุชู (ุงุฎุชูุงุฑู)</label>
          <div class="input-container">
            <i class="fas fa-phone input-icon"></i>
            <input type="tel" id="signup-phone" placeholder="ุฃุฏุฎู ุฑูู ูุงุชูู" />
          </div>
        </div>
        
        <div class="form-group terms">
          <input type="checkbox" id="accept-terms" required />
          <label for="accept-terms">ุฃูุงูู ุนูู <a href="#">ุงูุดุฑูุท ูุงูุฃุญูุงู</a> ู<a href="#">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a></label>
          <span class="error-message" id="accept-terms-error"></span>
        </div>
        
        <button type="submit" class="submit-btn">ุฅูุดุงุก ุญุณุงุจ</button>
      </form>
    </div>
  </div>
  
  <!-- ูููุฐุฌ ุงูุชุญูู ุจุฎุทูุชูู -->
  <div id="two-factor-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุงูุชุญูู ุจุฎุทูุชูู</h2>
        <button class="close-modal">&times;</button>
      </div>
      <p class="modal-description">ููุฏ ุฃุฑุณููุง ุฑูุฒ ุงูุชุญูู ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู. ุงูุฑุฌุงุก ุฅุฏุฎุงูู ุฃุฏูุงู.</p>
      <form id="two-factor-form">
        <div class="form-group">
          <label for="verification-code">ุฑูุฒ ุงูุชุญูู</label>
          <div class="input-container">
            <i class="fas fa-shield-alt input-icon"></i>
            <input type="text" id="verification-code" placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุชุญูู" maxlength="6" required />
          </div>
          <span class="error-message" id="verification-code-error"></span>
        </div>
        
        <div class="resend-code">
          <p>ูู ุชุณุชูู ุงูุฑูุฒุ <a href="#" id="resend-code-link">ุฅุนุงุฏุฉ ุฅุฑุณุงู</a></p>
          <p id="resend-timer"></p>
        </div>
        
        <button type="submit" class="submit-btn">ุชุญูู</button>
      </form>
    </div>
  </div>
  
  <!-- ุชุญููู ููุชุจุฉ Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script src="env.js"></script>
  <script src="config.js"></script>
  <script src="supabase-loader.js"></script>
  <script src="supabaseClient.js"></script>
  <script src="auth.js"></script>
  <script src="sidebar.js"></script>
  <script src="login.js"></script>

  <!-- Debug logging for logo images only -->
  <script>
    console.log('๐ Logo Debug Info:');
    console.log('Current URL:', window.location.href);

    // Test image loading events
    const logoImg = document.querySelector('.logo');
    if (logoImg) {
      console.log('โ Logo image element found');
      console.log('Logo src:', logoImg.src);

      logoImg.addEventListener('load', () => {
        console.log('โ Logo loaded successfully - Dimensions:', logoImg.naturalWidth + 'x' + logoImg.naturalHeight);
      });
      logoImg.addEventListener('error', (e) => {
        console.log('โ Logo failed to load:', e);
        console.log('Error details:', {
          src: logoImg.src,
          naturalWidth: logoImg.naturalWidth,
          naturalHeight: logoImg.naturalHeight,
          error: e
        });
      });

      // Check if image is already loaded
      if (logoImg.complete && logoImg.naturalWidth > 0) {
        console.log('โ Logo already loaded - Dimensions:', logoImg.naturalWidth + 'x' + logoImg.naturalHeight);
      }
    } else {
      console.log('โ Logo image element not found!');
    }
  </script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // ุงูุชุญูู ูู ูุฌูุฏ ุฌูุณุฉ ูุดุทุฉ ูุจู ุชุญููู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
    window.addEventListener('load', async () => {
      // ูุณุญ ุฃู ุจูุงูุงุช ูุฏููุฉ ุฃู ุชุงููุฉ
      if (typeof auth !== 'undefined') {
        try {
          // ูุณุญ ุฃู ุจูุงูุงุช ุฌูุณุฉ ูุฏููุฉ ุฃููุงู
          auth.clearUserSession();

          // ุงูุชุญูู ูู ูุฌูุฏ ุฌูุณุฉ ูุดุทุฉ ุตุงูุญุฉ
          const user = auth.checkUserSession();
          if (user && user.email && user.id) {
            // ุฅุฐุง ูุงู ููุงู ุฌูุณุฉ ูุดุทุฉ ุตุงูุญุฉุ ูู ุจุชูุฌูู ุงููุณุชุฎุฏู ุฅูู ุตูุญุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช
            console.log('ุฌูุณุฉ ูุดุทุฉ ููุฌูุฏุฉุ ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู dashboard.html');
            window.location.href = 'dashboard.html';
            return;
          }
        } catch (error) {
          console.warn('ุฎุทุฃ ูู ูุญุต ุงูุฌูุณุฉ:', error);
        }
      }

      // ูุณุญ ุฃู ุจูุงูุงุช ูุฏููุฉ ุฃุฎุฑู ูุฏ ุชุณุจุจ ูุดุงูู
      try {
        // ูุณุญ ุจูุงูุงุช ุงูุชุทุจูู ุงููุฏููุฉ
        localStorage.removeItem('clientData');
        localStorage.removeItem('harvestData');
        localStorage.removeItem('rowData');
        localStorage.removeItem('masterLimit');
        localStorage.removeItem('currentBalance');
        localStorage.removeItem('archiveData');

        // ูุณุญ ุฃู ุจูุงูุงุช ุชุทุจูู ุฃุฎุฑู ูุฏ ุชููู ููุฌูุฏุฉ
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && (key.startsWith('app_') || key.startsWith('temp_'))) {
            keysToRemove.push(key);
          }
        }
        keysToRemove.forEach(key => localStorage.removeItem(key));

        console.log('ุชู ูุณุญ ุงูุจูุงูุงุช ุงููุคูุชุฉ');
      } catch (error) {
        console.warn('ุฎุทุฃ ูู ูุณุญ ุงูุจูุงูุงุช ุงููุคูุชุฉ:', error);
      }

      // ุชุณุฌูู Service Worker ูุฏุนู ุฎุตุงุฆุต PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker registered:', reg))
          .catch(err => console.error('Service Worker registration failed:', err));
      }
    });
  </script>
</body>
</html>




